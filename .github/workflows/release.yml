name: Release

on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Homebrew
      uses: Homebrew/actions/setup-homebrew@master
    
    - name: Validate cask
      run: ruby -c homebrew-all-fonts.rb
    
    - name: Create release archive
      run: |
        mkdir -p release
        cp homebrew-all-fonts.rb release/
        cp README.md release/
        cp LICENSE release/
        cp CHANGELOG.md release/
        cp CONTRIBUTING.md release/
        cp CASK_INSTALLATION.md release/
        cp IMPROVEMENTS.md release/
        cp invalid_brew_fonts_list_*.txt release/ 2>/dev/null || echo "No invalid fonts list found"
        tar -czf homebrew-all-fonts-v1.0.0.tar.gz -C release .
    
    - name: Display installation instructions
      run: |
        echo "========================================="
        echo "Release published successfully!"
        echo "========================================="
        echo ""
        echo "Users can install with:"
        echo "  brew install --cask https://raw.githubusercontent.com/Emasoft/homebrew_all_fonts/main/homebrew-all-fonts.rb"
        echo ""
        echo "Or clone and install:"
        echo "  git clone https://github.com/Emasoft/homebrew_all_fonts.git"
        echo "  cd homebrew_all_fonts"
        echo "  brew install --cask homebrew-all-fonts.rb"
        echo "========================================="
